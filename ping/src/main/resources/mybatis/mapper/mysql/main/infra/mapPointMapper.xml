<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lalaping.mall.mapPoint.MapPointDao">
	<resultMap type="com.lalaping.mall.mapPoint.MapPointDto" id="resultMapObj"></resultMap>
	
	<sql id="selectCommon">
        FROM mapPoint a
        	left join fishandmappoint b on b.mappoint_mpSeq = a.mpSeq
            left join fish c on c.fsSeq = b.fish_fsSeq
        WHERE 1=1
        <if test="shValue != null and !shValue.equals('')">
            <choose>
                <when test="shOption == null">
                    AND(
                        a.mpTitle LIKE CONCAT('%', #{shValue}, '%')
                        OR a.mpText LIKE CONCAT('%', #{shValue}, '%')
                    )
                </when>
                <when test="shOption == 1 and shOption != null and shOption != ''">
                    AND a.mpTitle = #{shValue}
                </when>
                <when test="shOption == 2 and shOption != null and shOption != ''">
                    AND a.mpAddress LIKE CONCAT('%', #{shValue}, '%')
                </when>
            </choose>
        </if>
        <if test="shDelNy != null and !shDelNy.equals('')">
            AND a.mpDelNy = #{shDelNy}
        </if>
        <if test="shType != null and !shType.equals('')">
            AND a.mpType = #{shType}
        </if>
        <if test="(shDateStart != null and !shDateStart.equals('')) and (shDateEnd != null and !shDateEnd.equals(''))">
        	<choose>
        		<when test="shOptionDate == 1"> AND a.mpRegDate BETWEEN #{shDateStart} AND #{shDateEnd}</when>
           	</choose>
        </if>
       
    </sql>
    
    <select id="selectList" resultMap="resultMapObj">
    	<include refid="base.selectListUpperForMysql"/>
    	SELECT
    		a.mpSeq
    		,a.mpTitle
    		,a.mpText
    		,a.mpAddress
    		,a.mpType
    		,a.mpDelNy
    		,a.mpRegDate
   		<include refid="selectCommon"/>
   		ORDER BY
     	a.mpRegDate DESC
		<include refid="base.selectListLowerForMysql"/>
    </select>
    <select id="selectUsrList" resultMap="resultMapObj">
    	SELECT
    		a.mpSeq
    		,a.mpTitle
    		,a.mpText
    		,a.mpAddress
    		,a.mpType
    		,a.mpDelNy
    		,a.mpRegDate
    		,GROUP_CONCAT(c.fsName ORDER BY c.fsSeq) AS fsNameList
   		FROM mappoint a
        	left join fishandmappoint b on b.mapPoint_mpSeq = a.mpSeq
            left join fish c on c.fsSeq = b.fish_fsSeq
   		GROUP BY a.mpSeq
   		ORDER BY
     	a.mpRegDate DESC
     	limit #{rowNumToShow}
    </select>
    <select id="allList" resultMap="resultMapObj">
    	SELECT
    		a.mpSeq
    		,a.mpTitle
    		,a.mpText
    		,a.mpAddress
    		,a.mpType
    		,a.mpDelNy
    		,a.mpRegDate
    		,GROUP_CONCAT(c.fsName ORDER BY c.fsSeq) AS fsNameList
   		FROM mapPoint a
        	left join fishandmappoint b on b.mapPoint_mpSeq = a.mpSeq
            left join fish c on c.fsSeq = b.fish_fsSeq
   		GROUP BY a.mpSeq
   		ORDER BY
     	a.mpRegDate DESC
    </select>
    <select id="sessSelectList" resultMap="resultMapObj">
    	SELECT
    		a.mpSeq
    		,a.mpTitle
    		,a.mpText
    		,a.mpAddress
    		,a.mpType
    		,a.mpDelNy
    		,a.mpRegDate
    		,GROUP_CONCAT(c.fsName ORDER BY c.fsSeq) AS fsNameList
            ,d.season_ssSeq
        FROM mappoint a
        	left join fishandmappoint b on b.mapPoint_mpSeq = a.mpSeq
            left join fish c on c.fsSeq = b.fish_fsSeq
            join seasonandfish d on d.fish_fsSeq = c.fsSeq
        WHERE 1=1
        	and d.season_ssSeq = #{season_ssSeq}
		GROUP BY a.mpSeq, d.season_ssSeq
   		ORDER BY
     	a.mpRegDate DESC
     	limit 8
    </select>
    
    <insert id="insert">
    	INSERT INTO mappoint(
    		mpTitle
    		,mpText
    		,mpAddress
    		,mpType
    		,mpDelNy
    		,mpRegDate
    	)VALUES(
    		#{mpTitle}
    		,#{mpText}
    		,#{mpAddress}
    		,#{mpType}
    		,0
    		,now()
    	)
    </insert>
    
    <select id="selectOne">
    	SELECT
    		a.mpSeq
    		,a.mpTitle
    		,a.mpText
    		,a.mpAddress
    		,a.mpType
    		,a.mpDelNy
    		,a.mpRegDate
    		,a.mpLatitude
    		,a.mpLongitude
   		FROM mappoint a
   		WHERE 1=1
   		AND mpSeq = #{mpSeq}
    </select>
    <select id="selectUsrOne">
    	SELECT
    		a.mpSeq
    		,a.mpTitle
    		,a.mpText
    		,a.mpAddress
    		,a.mpType
    		,a.mpDelNy
    		,a.mpRegDate
    		,a.mpLatitude
    		,a.mpLongitude
    		,GROUP_CONCAT(c.fsName ORDER BY c.fsSeq) AS fsNameList
   		FROM mappoint a
        	left join fishandmappoint b on b.mapPoint_mpSeq = a.mpSeq
            left join fish c on c.fsSeq = b.fish_fsSeq
   		WHERE 1=1
   			AND mpSeq = #{mpSeq}
   		GROUP BY a.mpSeq
    </select>
    <update id="update">
    	UPDATE mappoint
    	SET
    		mpTitle = #{mpTitle}
    		,mpText = #{mpText}
    		,mpAddress = #{mpAddress}
    		,mpType = #{mpType}
		WHERE 1=1
		AND mpSeq = #{mpSeq}
    </update>
    
    <update id="uelete">
  		UPDATE mappoint
  		SET
  			mpDelNy = 1
		WHERE 1=1
		AND mpSeq = #{mpSeq}
    </update>
    
    <delete id="delect">
    	 DELETE FROM mappoint
        WHERE mpSeq = #{mpSeq}
    </delete>
	
</mapper>