<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="ThemeStarz">

    <!--CSS -->
   	<link rel="stylesheet" href="/usr/v1/template/themeforest-v1.0/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/usr/v1/template/themeforest-v1.0/assets/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="/usr/v1/template/themeforest-v1.0/assets/css/leaflet.css">
    <link rel="stylesheet" href="/usr/v1/template/themeforest-v1.0/assets/css/style.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<!-- iamport.payment.js 1.1.7로 변경 -->
	<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.7.js"></script>
   
     <!-- dev -->
    <link rel="stylesheet" href="/usr/v1/css/common.css">

	<title>MyHouse - Advanced Real Estate HTML Template by ThemeStarz</title>

</head>

<body>

<!-- WRAPPER
    =================================================================================================================-->
<div class="ts-page-wrapper ts-has-bokeh-bg" id="page-top">

    <!--*********************************************************************************************************-->
    <!--HEADER **************************************************************************************************-->
    <!--*********************************************************************************************************-->
    <div th:replace="~{usr/v1/etc/head :: page-header}"></div>
    <!--end Header-->

    <!--*********************************************************************************************************-->
    <!-- MAIN ***************************************************************************************************-->
    <!--*********************************************************************************************************-->

    <main id="ts-main">

        <!--BREADCRUMB
            =========================================================================================================-->
        <section id="breadcrumb">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Library</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Data</li>
                    </ol>
                </nav>
            </div>
        </section>

        <!--PAGE TITLE
            =========================================================================================================-->
        <section id="page-title">
            <div class="container">
                <div class="row">
                    <div class="offset-lg-1 col-lg-10">
                        <div class="ts-title">
                            <h1>
                                <i class="fa fa-credit-card ts-opacity__30 mr-3"></i>
                                결제
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!--EDIT FORM
            =========================================================================================================-->
        <section id="edit-form">
            <div class="container">
                <div class="row">

                    <div class="offset-lg-1 col-lg-10">

                        <form method="post" action="/v1/checkout/checkoutInst" id="checkoutForm" class="ts-form">

                            <section id="basic-information" class="mb-5">

                                <!--Title-->
                                <h3 class="text-muted border-bottom">예약 고객</h3>

                                <!--Row-->
                                <div class="row">

                                    <!--Title-->
                                    <div class="col-sm-8">
                                        <div class="form-group">
                                            <label for="title">예약 고객님</label>
                                            <div class="input-group-append">
                                                <span class="border-left-0" th:text="${session.sessNameUsr}"></span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="title">이메일</label>
                                            <div class="input-group-append" th:text="${session.sessIdUsr}">
                                                <span class="border-left-0">qwer1234@gmail.com</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!--Price-->
                                    

                                    <div class="col-sm-12 col-md-4">

                                        <div class="row">

                                            <!--Area-->
                                            

                                            <!--Rooms-->
                                            <div class="col">
                                                <div class="input-group">
                                                    <label for="price">전화번호</label>
                                                    <span class="border-left-0" th:text="${memberitem.mmTel}">010-0000-1111</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--end row-->
                            </section>

                            <!--BASIC INFORMATION
                                =====================================================================================-->
                            <section id="basic-information" class="mb-5">

                                <!--Title-->
                                <h3 class="text-muted border-bottom">예약 상품</h3>

                                <!--Row-->
                                <div class="row">

                                    <!--Title-->
                                    <div class="col-sm-2">
                                        <div class="form-group">
                                            <label for="title">배이름</label>
                                            <div class="input-group-append">
                                                <span class="border-left-0" name="spName" th:text="${item.spName}">누리호</span>
                                            </div>
                                        </div>
                                        
                                    </div>
                                    

                                    <!--Price-->
                                    

                                    <div class="col-sm-12 col-md-10">

                                        <div class="row">

                                            <!--Area-->
                                            <div class="col">
                                                <div class="input-group">
                                                    <label for="area">주소</label>
                                                    <span class="border-left-0" th:text="${item.ptAddress}">부산항</span>
                                                </div>
                                            </div>
                                            <div class="col">
                                                <div class="input-group">
                                                    <label for="area">항구명</label>
                                                    <span class="border-left-0" th:text="${item.ptName}">부산항</span>
                                                </div>
                                            </div>

                                            <!--Rooms-->
                                            <div class="col">
                                                <select class="custom-select my-2" id="type" name="odCount" style="max-height: 200px; overflow-y: auto;">
						                            <option value="">인원</option>
						                            <option th:each="i : ${#numbers.sequence(1, item.spTotal)}" 
						                                th:value="${i}" th:text="${i + '인'}"></option>
						                        </select>
                                            </div>
                                            <input type="hidden" name="spName" th:value="${item.spName}">
                                            <input type="hidden" name="spSeq" th:value="${item.spSeq}">
                                            <input type="hidden" name="spPrice" th:value="${item.spPrice}">
                                            <input type="hidden" id="mmSeq" name="mmSeq" th:value="${session.sessSeqUsr}">
                                        </div>
                                        <!--end row-->

                                    </div>
                                    <!--end col-md-4-->

                                    <!--Type Select-->
                                    
                                    <div class="col-sm-2">
                                        <div class="input-group">
                                            <label for="area">출발일</label>
                                            <span th:text="${#dates.format(item.spStart, 'yyyy-MM-dd HH:mm')}">2024-12-31</span>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="input-group">
                                            <label for="area">식사제공</label>
                                            <span th:if="${item.spEatNy eq 0}">N</span>
                                            <span th:unless="${item.spEatNy eq 0}">Y</span>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="input-group">
                                            <label for="area">낚시대대여</label>
                                            <span th:if="${item.spRentalNy eq 0}">N</span>
                                            <span th:unless="${item.spRentalNy eq 0}">Y</span>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="input-group">
                                            <label for="price">총가격</label>
                                            <span name="odTotalPrice">220,000</span>
                                            <div class="input-group-append">
                                                <span>원</span>
                                            </div>
                                        </div>
                                    </div>

                                    

                                </div>
                                <!--end row-->
                            </section>

                            <!--LOCATION
                                =====================================================================================-->
                            

                           

                            <!--ADDITIONAL INFORMATION
                                =====================================================================================-->
                           

                            <hr>

                            <section class="py-3">
                                <button class="btn btn-outline-secondary btn-lg float-left">
                                    <i class="fa fa-times mr-2"></i>
                                    돌아가기
                                </button>
                                <button type="button" onclick="requestPay()" class="btn btn-primary btn-lg float-right">
                                    카카오페이 결제
                                </button>
                            </section>

                        </form>
                        <!--end #form-submit-->

                    </div>
                    <!--end offset-lg-1 col-lg-10-->
                </div>
                <!--end row-->
            </div>
            <!--end container-->
        </section>

    </main>
    <!--end #ts-main-->

    <!--*********************************************************************************************************-->
    <!--************ FOOTER *************************************************************************************-->
    <!--*********************************************************************************************************-->
 	<div th:replace="~{usr/v1/etc/footer :: page-footer}"></div>
    <!--end #ts-footer-->

</div>
<!--end page-->

<script src="/usr/v1/template/themeforest-v1.0/assets/js/jquery-3.3.1.min.js"></script>
<script src="/usr/v1/template/themeforest-v1.0/assets/js/popper.min.js"></script>
<script src="/usr/v1/template/themeforest-v1.0/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="http://maps.google.com/maps/api/js"></script>
<script src="/usr/v1/template/themeforest-v1.0/assets/js/leaflet.js"></script>
<script src="/usr/v1/template/themeforest-v1.0/assets/js/custom.js"></script>
<script src="/usr/v1/js/script.js"></script>
<script src="/usr/v1/template/themeforest-v1.0/assets/js/map-leaflet.js"></script>
<script>
	    // IAMPORT 초기화
	    var IMP = window.IMP;
	    IMP.init("imp75302860");  // 이 값은 IAMPORT 대시보드에서 받은 본인의 상점 아이디로 바꿔야 합니다.
	
	    // 랜덤 merchant_uid 생성 함수
	    function generateMerchantUid() {
	        var date = new Date().getTime();  // 현재 시간 (밀리초)
	        var randomNum = Math.floor(Math.random() * 1000000);  // 0부터 999999까지의 랜덤 숫자
	        return 'merchant_' + date + '-' + randomNum;  // 예: merchant_1637796621278-56123
	    }
	
	    // 결제 요청 함수
	    function requestPay() {
	        var merchantUid = generateMerchantUid(); // 랜덤 merchant_uid 생성
	        var spName = $("input[name='spName']").val(); // 상품명
	        var odTotalPrice = $("input[name='odTotalPrice']").val(); // 결제 금액
// 	        var spSeq = $("input[name='spSeq']").val();
// 	        var mmSeq = $("input[name='mmSeq']").val();
	
	        IMP.request_pay({
	            pg: "kakaopay.TC0ONETIME", // Test용 카카오페이 PG 코드
	            pay_method: "card",  // 카드 결제 방법
	            merchant_uid: merchantUid, // 생성된 랜덤 merchant_uid
	            name: spName,  // 결제 상품명
	            amount: 2000,  // 결제 금액
	            buyer_email: 'test@naver.com',
	            buyer_name: '홍길동',
	            buyer_tel: '010-1234-5678',
	            buyer_addr: '서울특별시',
	            buyer_postcode: '123-456'
	        }, function (rsp) {
	            if (rsp.success) {
	                // 결제 성공 시 서버로 결제 정보 전송
	                $.ajax({
	                    type: 'POST',
	                    url: '/v1/checkout/checkoutInst',
	                    data: {
	                        mmSeq: $("#mmSeq").val(),  // mmSeq 값 가져오기
	                        spSeq: $("input[name='spSeq']").val()  // pdSeq 값 가져오기
	                    },
	                    success: function (data) {
	                        if (rsp.success) {
	                            alert("결제 성공");
	                            window.location.href = "/v1/member/orderList";
	                        } else {
	                            alert("결제 실패");
	                        }
	                    },
	                    error: function () {
	                        alert("서버 요청 실패");
	                    }
	                });
	            } else {
	                alert("결제 실패: " + rsp.error_msg);  // 결제 실패 시 에러 메시지
	            }
	        });
	    }
	
	    // 카카오페이 결제 버튼 클릭 시 결제 요청
	    $('#kakaoPayBtn').click(function () {
	        requestPay();  // 결제 요청 함수 호출
	    });
	</script>

</body>
</html>

